name: ğŸ¯ Manual Test Execution

on:
  workflow_dispatch:
    inputs:
      test_type:
        description: 'Tipo de teste'
        required: true
        default: 'all'
        type: choice
        options:
        - all
        - api-auth
        - api-movies
        - api-reservations
        - web-auth
        - web-navigation
        - web-booking
        - web-profile
      environment:
        description: 'Ambiente'
        required: true
        default: 'production'
        type: choice
        options:
        - production
        - staging

jobs:
  manual-execution:
    name: ğŸ§ª ExecuÃ§Ã£o Manual
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ğŸ”§ Instalar dependÃªncias
      run: |
        pip install -r requirements.txt
        rfbrowser init
        
    - name: ğŸ§ª Executar testes selecionados
      run: |
        case "${{ github.event.inputs.test_type }}" in
          "all")
            robot --outputdir results --include AUTH* --include MOV* --include RES* tests/api/
            xvfb-run -a robot --outputdir results --variable HEADLESS:true tests/web/
            ;;
          "api-auth")
            robot --outputdir results --include AUTH* tests/api/
            ;;
          "api-movies")
            robot --outputdir results --include MOV* tests/api/
            ;;
          "api-reservations")
            robot --outputdir results --include RES* tests/api/
            ;;
          "web-auth")
            xvfb-run -a robot --outputdir results --variable HEADLESS:true --include WEB-AUTH* tests/web/
            ;;
          "web-navigation")
            xvfb-run -a robot --outputdir results --variable HEADLESS:true --include WEB-NAV* tests/web/
            ;;
          "web-booking")
            xvfb-run -a robot --outputdir results --variable HEADLESS:true --include WEB-BOOK* tests/web/
            ;;
          "web-profile")
            xvfb-run -a robot --outputdir results --variable HEADLESS:true --include WEB-PROF* tests/web/
            ;;
        esac
        
    - name: ğŸ“Š Upload resultados
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: manual-test-results-${{ github.event.inputs.test_type }}
        path: results/